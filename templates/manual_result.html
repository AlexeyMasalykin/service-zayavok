{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –∑–∞—è–≤–∫–∏ - –°–µ—Ä–≤–∏—Å –∑–∞—è–≤–æ–∫{% endblock %}

{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <div class="ui-head text-center mb-4">
        <h2 class="text-gradient">‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</h2>
        <p class="text-secondary">–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –±—ã–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ò–ò</p>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ -->
      <div class="ui-card mb-4">
        <div class="d-flex align-items-center mb-3">
          <div class="d-inline-flex align-items-center justify-content-center bg-success bg-gradient rounded-circle me-3" style="width: 48px; height: 48px;">
            <i class="bi bi-check-circle text-white fs-4"></i>
          </div>
          <div>
            <h5 class="mb-1">–ó–∞—è–≤–∫–∞ #{{ application_id }}</h5>
            <p class="text-muted mb-0">{{ datetime.now().strftime('%d.%m.%Y –≤ %H:%M') }}</p>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <p><strong>–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:</strong> {{ application.name or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
            <p><strong>Email:</strong> {{ application.email or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ application.phone or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>–ö–æ—Ä–ø—É—Å/—Ñ–∏–ª–∏–∞–ª:</strong> {{ application.department or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
            <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ application.cost or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</p>
            <p><strong>–û–±—â–∞—è —Å—É–º–º–∞:</strong> {{ application.total_sum or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</p>
          </div>
        </div>
      </div>

      <!-- –ò–ò-–∞–Ω–∞–ª–∏–∑ -->
      {% if application.rating and application.ai_analysis %}
      <div class="ui-card mb-4">
        <div class="d-flex align-items-center mb-3">
          <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-gradient rounded-circle me-3" style="width: 48px; height: 48px;">
            <i class="bi bi-robot text-white fs-4"></i>
          </div>
          <div>
            <h5 class="mb-1">–ò–ò-–∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞—è–≤–∫–∏</h5>
            <div class="d-flex align-items-center">
              <span class="me-2">–†–µ–π—Ç–∏–Ω–≥:</span>
              {% set rating_class = 'success' if application.rating >= 7 else ('warning' if application.rating >= 4 else 'danger') %}
              <span class="badge bg-{{ rating_class }}-subtle text-{{ rating_class }} fs-6">
                {{ "%.1f"|format(application.rating) }}/10
              </span>
            </div>
          </div>
        </div>
        
        <div class="alert alert-light border">
          <div style="white-space: pre-wrap;">{{ application.ai_analysis }}</div>
        </div>
      </div>
      {% endif %}

      <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
      {% if application.items %}
      <div class="ui-card mb-4">
        <h5 class="mb-3">üì¶ –¢–æ–≤–∞—Ä—ã –≤ –∑–∞—è–≤–∫–µ</h5>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>‚Ññ</th>
                <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                <th>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</th>
                <th>–ï–¥. –∏–∑–º.</th>
                <th>–ö–æ–ª-–≤–æ</th>
                <th>–¶–µ–Ω–∞</th>
              </tr>
            </thead>
            <tbody>
              {% for item in application.items %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ item.item_name }}</td>
                <td>{{ item.characteristics or '-' }}</td>
                <td>{{ item.unit or '-' }}</td>
                <td>{{ item.quantity or '-' }}</td>
                <td>{{ item.price or '-' }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      {% endif %}

      <!-- –î–µ–π—Å—Ç–≤–∏—è -->
      <div class="text-center">
        <a href="{{ url_for('track_application') }}?id={{ application_id }}" class="btn btn-primary btn-lg me-2">
          <i class="bi bi-search me-2"></i>–û—Ç—Å–ª–µ–¥–∏—Ç—å –∑–∞—è–≤–∫—É
        </a>
        <a href="{{ url_for('manual.manual_form') }}" class="btn btn-outline-secondary btn-lg me-2">
          <i class="bi bi-plus-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –µ—â–µ
        </a>
        <a href="{{ url_for('home') }}" class="btn btn-outline-primary btn-lg">
          <i class="bi bi-house me-2"></i>–ù–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
      </div>
      
    </div>
  </div>
</div>
{% endblock %}
