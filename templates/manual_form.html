{% extends "base.html" %}

{% block title %}–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ - –°–µ—Ä–≤–∏—Å –∑–∞—è–≤–æ–∫{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
      <div class="ui-head text-center mb-4">
        <h2 class="text-gradient">üìù –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏</h2>
        <p class="text-secondary">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –æ–Ω–ª–∞–π–Ω –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –∏–∑ Excel</p>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
      <form id="manualForm" class="ui-card">
        <div class="row">
          
          <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
          <div class="col-md-6">
            <h5 class="text-primary mb-3">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
            
            <div class="mb-3">
              <label class="form-label">–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∑–∞—è–≤–∫–∏ (–§–ò–û, –¥–æ–ª–∂–Ω–æ—Å—Ç—å) <span class="text-danger">*</span></label>
              <input type="text" name="initiator" class="form-control" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò., –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å">
            </div>
            
            <div class="mb-3">
              <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –∑–∞–∫—É–ø–∫–∏ (–∫—Ä–∞—Ç–∫–æ) <span class="text-danger">*</span></label>
              <textarea name="description" class="form-control" rows="3" required placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–∫—É–ø–∞–µ–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥"></textarea>
            </div>
            
            <div class="mb-3">
              <label class="form-label">–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å <span class="text-danger">*</span></label>
              <input type="text" name="cost" class="form-control" required placeholder="15 000 —Ä—É–±.">
            </div>
            
            <div class="mb-3">
              <label class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –∑–∞—è–≤–∫–∏ <span class="text-danger">*</span></label>
              <input type="tel" name="phone" class="form-control" required placeholder="+7 (___) ___-__-__">
            </div>
          </div>
          
          <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
          <div class="col-md-6">
            <h5 class="text-primary mb-3">üìç –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
            
            <div class="mb-3">
              <label class="form-label">–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã <span class="text-danger">*</span></label>
              <input type="email" name="email" class="form-control" required placeholder="example@email.com">
            </div>
            
            <div class="mb-3">
              <label class="form-label">–ö–æ—Ä–ø—É—Å, —Ñ–∏–ª–∏–∞–ª <span class="text-danger">*</span></label>
              <input type="text" name="department" class="form-control" required placeholder="–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–ø—É—Å">
            </div>
            
            <div class="mb-3">
              <label class="form-label">–û–±—â–∞—è —Å—É–º–º–∞</label>
              <input type="text" name="total_sum" class="form-control" placeholder="15 000 —Ä—É–±.">
            </div>
            
            <div class="mb-3">
              <label class="form-label">–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –∑–∞–∫—É–ø–∫–∏</label>
              <textarea name="justification" class="form-control" rows="3" placeholder="–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–∫—É–ø–∫–∏"></textarea>
            </div>
          </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="mt-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="text-primary mb-0">üõí –û–±—ä–µ–∫—Ç –∑–∞–∫—É–ø–∫–∏</h5>
            <div>
              <button type="button" class="btn btn-outline-success btn-sm me-2" onclick="addTableRow()">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
              </button>
              <label class="btn btn-outline-primary btn-sm me-2">
                <i class="bi bi-file-earmark-excel"></i> –ò–º–ø–æ—Ä—Ç –∏–∑ Excel
                <input type="file" id="excelFile" accept=".xlsx,.xls" style="display: none;" onchange="importExcel()">
              </label>
              <a href="{{ url_for('manual.download_excel_template') }}" class="btn btn-outline-info btn-sm" title="–°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑–µ—Ü Excel —Ñ–∞–π–ª–∞">
                <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑–µ—Ü
              </a>
            </div>
          </div>
          
          <div class="table-responsive">
            <table id="itemsTable" class="table table-bordered">
              <thead class="table-light">
                <tr>
                  <th width="5%" class="text-center" style="white-space: nowrap; min-width: 40px;">‚Ññ</th>
                  <th width="20%" style="white-space: nowrap; min-width: 150px; padding: 8px 12px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ <span class="text-danger">*</span></th>
                  <th width="25%" style="white-space: nowrap; min-width: 180px; padding: 8px 12px;">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</th>
                  <th width="15%" style="white-space: nowrap; min-width: 120px; padding: 8px 12px;">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</th>
                  <th width="10%" class="text-center" style="white-space: nowrap; min-width: 80px; padding: 8px 12px;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                  <th width="15%" class="text-center" style="white-space: nowrap; min-width: 100px; padding: 8px 12px;">–¶–µ–Ω–∞ –∑–∞ –µ–¥., —Ä—É–±</th>
                  <th width="5%" class="text-center" style="white-space: nowrap; min-width: 50px; padding: 8px 4px;"><i class="bi bi-trash text-muted"></i></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td><textarea class="form-control form-control-sm item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required rows="2" style="resize: vertical; min-height: 38px;"></textarea></td>
                  <td><textarea class="form-control form-control-sm item-characteristics" placeholder="–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏" rows="2" style="resize: vertical; min-height: 38px;"></textarea></td>
                  <td><input type="text" class="form-control form-control-sm item-unit" placeholder="—à—Ç., –∫–≥, –ª, –º¬≤, –º.–ø., –ø–∞—á–∫–∞, –∫–æ–º–ø–ª–µ–∫—Ç" style="min-width: 120px;"></td>
                  <td><input type="number" class="form-control form-control-sm item-quantity" placeholder="1" min="0"></td>
                  <td><input type="number" class="form-control form-control-sm item-price" placeholder="0.00" min="0" step="0.01"></td>
                  <td><button type="button" class="btn btn-outline-danger btn-sm" onclick="removeTableRow(this)" disabled><i class="bi bi-trash"></i></button></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è Excel -->
          <div class="mt-2">
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              <strong>–°–æ–≤–µ—Ç:</strong> –°–∫–∞—á–∞–π—Ç–µ –æ–±—Ä–∞–∑–µ—Ü Excel —Ñ–∞–π–ª–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã.
            </small>
          </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-circle"></i> –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
          </button>
          <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-lg ms-2">
            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
          </a>
        </div>
      </form>
      
    </div>
  </div>
</div>

<script>
let rowCounter = 1;

function addTableRow() {
  rowCounter++;
  const tbody = document.querySelector('#itemsTable tbody');
  const newRow = document.createElement('tr');
  newRow.innerHTML = `
    <td>${rowCounter}</td>
    <td><textarea class="form-control form-control-sm item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required rows="2" style="resize: vertical; min-height: 38px;"></textarea></td>
    <td><textarea class="form-control form-control-sm item-characteristics" placeholder="–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏" rows="2" style="resize: vertical; min-height: 38px;"></textarea></td>
    <td><input type="text" class="form-control form-control-sm item-unit" placeholder="—à—Ç., –∫–≥, –ª, –º¬≤, –º.–ø., –ø–∞—á–∫–∞, –∫–æ–º–ø–ª–µ–∫—Ç" style="min-width: 120px;"></td>
    <td><input type="number" class="form-control form-control-sm item-quantity" placeholder="1" min="0"></td>
    <td><input type="number" class="form-control form-control-sm item-price" placeholder="0.00" min="0" step="0.01"></td>
    <td><button type="button" class="btn btn-outline-danger btn-sm" onclick="removeTableRow(this)"><i class="bi bi-trash"></i></button></td>
  `;
  tbody.appendChild(newRow);
  updateRowNumbers();
}

function removeTableRow(button) {
  if (document.querySelectorAll('#itemsTable tbody tr').length > 1) {
    button.closest('tr').remove();
    updateRowNumbers();
  }
}

function updateRowNumbers() {
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  rows.forEach((row, index) => {
    row.cells[0].textContent = index + 1;
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
    const deleteBtn = row.querySelector('.btn-outline-danger');
    deleteBtn.disabled = rows.length === 1;
  });
}

function importExcel() {
  const fileInput = document.getElementById('excelFile');
  const file = fileInput.files[0];
  
  if (!file) return;
  
  const formData = new FormData();
  formData.append('excel_file', file);
  
  fetch('/import_excel', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
      const tbody = document.querySelector('#itemsTable tbody');
      tbody.innerHTML = '';
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
      data.items.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td><textarea class="form-control form-control-sm item-name" required rows="2" style="resize: vertical; min-height: 38px;">${item.item_name}</textarea></td>
          <td><textarea class="form-control form-control-sm item-characteristics" rows="2" style="resize: vertical; min-height: 38px;">${item.characteristics}</textarea></td>
          <td><input type="text" class="form-control form-control-sm item-unit" value="${item.unit}" style="min-width: 120px;"></td>
          <td><input type="number" class="form-control form-control-sm item-quantity" value="${item.quantity}" min="0"></td>
          <td><input type="number" class="form-control form-control-sm item-price" value="${item.price}" min="0" step="0.01"></td>
          <td><button type="button" class="btn btn-outline-danger btn-sm" onclick="removeTableRow(this)" ${index === 0 && data.items.length === 1 ? 'disabled' : ''}><i class="bi bi-trash"></i></button></td>
        `;
        tbody.appendChild(row);
      });
      
      rowCounter = data.items.length;
      window.showToast('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ Excel —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
    } else {
      window.showToast('‚ùå ' + data.message, 'danger');
    }
  })
  .catch(error => {
    window.showToast('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–∞', 'danger');
    console.error('Error:', error);
  });
  
  // –û—á–∏—â–∞–µ–º input
  fileInput.value = '';
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('manualForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // –ü–æ–ª—É—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
  const submitBtn = document.querySelector('button[type="submit"]');
  const originalBtnText = submitBtn.innerHTML;
  
  // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
  const rows = document.querySelectorAll('#itemsTable tbody tr');
  const items = [];
  
  rows.forEach(row => {
    const item = {
      item_name: row.querySelector('.item-name').value,
      characteristics: row.querySelector('.item-characteristics').value,
      unit: row.querySelector('.item-unit').value,
      quantity: row.querySelector('.item-quantity').value,
      price: row.querySelector('.item-price').value
    };
    if (item.item_name.trim()) {  // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
      items.push(item);
    }
  });
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç
  if (items.length === 0) {
    window.showToast('‚ùå –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –≤ —Ç–∞–±–ª–∏—Ü—É', 'warning');
    return;
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏...';
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π
  let progressDiv = document.getElementById('progress-indicator');
  if (!progressDiv) {
    progressDiv = document.createElement('div');
    progressDiv.id = 'progress-indicator';
    progressDiv.className = 'mt-2 text-center';
    submitBtn.parentNode.appendChild(progressDiv);
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
  let currentStep = 0;
  const steps = [
    'üìù –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...',
    'ü§ñ –ò–ò-–∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞—è–≤–∫–∏...',
    'üìß –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...',
    '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...'
  ];
  
  progressDiv.innerHTML = `<small class="text-muted">${steps[0]}</small>`;
  
  const stepInterval = setInterval(() => {
    currentStep++;
    if (currentStep < steps.length && !submitBtn.classList.contains('btn-success')) {
      progressDiv.innerHTML = `<small class="text-muted">${steps[currentStep]}</small>`;
    }
  }, 1500);
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
  const formData = new FormData(this);
  formData.append('items_data', JSON.stringify(items));
  
  fetch('/submit_manual', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
    clearInterval(stepInterval);
    
    if (data.success) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ —É—Å–ø–µ—Ö
      submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i>–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!';
      submitBtn.classList.remove('btn-primary');
      submitBtn.classList.add('btn-success');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      progressDiv.innerHTML = '<small class="text-success"><i class="bi bi-check-circle me-1"></i>–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ò–ò!</small>';
      
      window.showToast('‚úÖ ' + data.message, 'success');
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –ò–ò-–∞–Ω–∞–ª–∏–∑–æ–º
      setTimeout(() => {
        if (data.redirect_url) {
          window.location.href = data.redirect_url;
        } else {
          window.location.href = `/track?id=${data.application_id}`;
        }
      }, 2000);
    } else {
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalBtnText;
      progressDiv.innerHTML = '<small class="text-danger"><i class="bi bi-exclamation-triangle me-1"></i>–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏</small>';
      window.showToast('‚ùå ' + data.message, 'danger');
    }
  })
  .catch(error => {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª
    clearInterval(stepInterval);
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
    submitBtn.disabled = false;
    submitBtn.innerHTML = originalBtnText;
    progressDiv.innerHTML = '<small class="text-danger"><i class="bi bi-exclamation-triangle me-1"></i>–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏</small>';
    window.showToast('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏', 'danger');
    console.error('Error:', error);
  });
});

// –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length >= 1) {
    value = '+7 (' + value.substring(1, 4) + ') ' + value.substring(4, 7) + '-' + value.substring(7, 9) + '-' + value.substring(9, 11);
  }
  e.target.value = value;
});
</script>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã */
#itemsTable {
  table-layout: auto;
  min-width: 100%;
  border-collapse: separate;
  border-spacing: 0;
}

#itemsTable th {
  background-color: #f8f9fa !important;
  border: 1px solid #dee2e6;
  padding: 12px 8px;
  font-weight: 600;
  font-size: 0.875rem;
  text-align: center;
  vertical-align: middle;
}

#itemsTable td {
  vertical-align: middle;
  padding: 8px;
  border: 1px solid #dee2e6;
}

#itemsTable .item-name,
#itemsTable .item-characteristics {
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: pre-wrap;
}

#itemsTable .item-unit {
  min-width: 140px;
  width: 140px;
}

#itemsTable textarea {
  border: 1px solid #ced4da;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  line-height: 1.4;
  width: 100%;
  min-height: 38px;
}

#itemsTable textarea:focus {
  border-color: #86b7fe;
  outline: 0;
  box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

#itemsTable input[type="text"],
#itemsTable input[type="number"] {
  width: 100%;
  min-height: 38px;
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ */
#itemsTable td:first-child {
  text-align: center;
  font-weight: 600;
  width: 40px;
  min-width: 40px;
}

/* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π */
#itemsTable td:last-child {
  text-align: center;
  width: 50px;
  min-width: 50px;
  padding: 8px 4px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
  #itemsTable {
    font-size: 0.8rem;
  }
  
  #itemsTable th,
  #itemsTable td {
    padding: 6px 4px;
  }
  
  #itemsTable .item-unit {
    min-width: 120px;
    width: 120px;
  }
  
  #itemsTable th {
    font-size: 0.75rem;
    padding: 8px 4px;
  }
  
  #itemsTable td:last-child {
    width: 45px;
    min-width: 45px;
    padding: 6px 2px;
  }
}

/* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
.table-responsive {
  overflow-x: auto;
}
</style>

{% endblock %}
